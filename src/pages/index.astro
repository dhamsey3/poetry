---
import Base from "../layouts/Base.astro";
import posts from "../data/posts.json";

const items = [...posts].sort((a, b) => new Date(b.date) - new Date(a.date));
const substackUrl = import.meta.env.PUBLIC_SUBSTACK_URL || "https://damii3.substack.com";
---
<Base title="Poems">
  {items.length === 0 ? (
    <section class="empty">
      <h2>New poems coming soon</h2>
      <p>Can’t load Substack right now. Read the latest on <a href={substackUrl} target="_blank" rel="noopener">Substack ↗</a>.</p>
    </section>
  ) : (
    <section class="feed">
      {items.map((p) => (
        <article class="card">
          <a class="cover" href={`${import.meta.env.BASE_URL}p/${p.slug}/`} aria-label={p.title}>
            {p.image && <img src={p.image} alt="" loading="lazy" />}
          </a>
          <div class="content">
            <h2><a href={`${import.meta.env.BASE_URL}p/${p.slug}/`}>{p.title}</a></h2>
            <time datetime={p.date}>
              {new Date(p.date).toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'})}
            </time>
            <p>{p.excerpt}</p>
            <div class="links">
              <a class="btn" href={`${import.meta.env.BASE_URL}p/${p.slug}/`}>Read</a>
              <a class="substack" href={p.url} target="_blank" rel="noopener">Original on Substack ↗</a>
            </div>
          </div>
        </article>
      ))}
    </section>
  )}
</Base>
